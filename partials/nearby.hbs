<div class="bg-gray-100 p-8">
  <h2 class="text-center mb-5">Nearby Locations</h2>
  <div class="location-data grid gap-x-5 gap-y-5 sm:px-10 md:px-0 md:grid-cols-3 lg:gap-x-20"> </div>
  {{!-- <div class="location-data justify-start grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-8"> </div> --}}

</div>


<script>
    document.addEventListener("DOMContentLoaded", function () {
    var baseURL = "https://liveapi.yext.com/v2/accounts/me/entities/geosearch?";
    var api_key = "c1be28fe46a4efb864aa9d8583108490";
    var vparam = "20181017";
    var lat = {{latitude}};
    var lng = {{longitude}};
    var location = lat + ", " + lng;
    var limit = 3;
    var radius = 500;
    var entityTypes =
        "location";
    var fields = "name,hours,address,mainPhone,websiteUrl,timeZoneUtcOffset,c_locationNickname,c_limitedAvailability,c_heroImagePage,c_heroImageThumbnail";
    const savedSearchIdString = "551464658";
    var fullURL =
        baseURL +
        "api_key=" +
        api_key +
        "&v=" +
        vparam +
        "&location=" +
        location +
        "&limit=" +
        (limit + 1) +
        "&radius=" +
        radius +
        "&entityTypes=" +
        entityTypes +
        "&fields=" +
        fields +
        "&resolvePlaceholders=true" +
        "&filter=%7B%22c_offline%22%3A%7B%22%24eq%22%3AFALSE%7D%7D";

    [].slice
        .call(document.querySelectorAll(".location-data") || [])
        .forEach(function (el) {
            el.innerHTML = '<div class="col">Loading...</div>';
        });
    $.get(fullURL, function (data) {
        entities = data.response.entities;

        [].slice
        .call(document.querySelectorAll(".location-data") || [])
        .forEach(function (el) {
            el.innerHTML = "";
        });
        if (
        entities.length == 0 ||
        (entities.length == 1 && entities[0].meta.id == "{{id}}")
        ) {
        [].slice
            .call(document.querySelectorAll(".location-data") || [])
            .forEach(function (el) {
            el.innerHTML = '<div class="col">No Locations Found</div>';
            });
        }
        for (var i = 1; i < entities.length; i++) {
        location = entities[i];
        locationHTML = "";
        //const parsedOffset = parseTimeZoneUtcOffset(location.timeZoneUtcOffset);
        var availability;
        if (location.c_limitedAvailability) {
          availability = "Limited Availability";
        } else {
          availability = "&#10003; Units Available";
        }
        //style="width:80%;height:auto;padding-top:2rem;padding-bottom:2rem;
        //style="width:100%;height:auto;        
        if (true) {
            if (location.websiteUrl) {
            locationHTML =
                '<div class="location grid grid-cols-1 shadow-md sm:grid-cols-2 grid gap-x-5 gap-y-3 md:grid-cols-1 bg-white ">' +
                '<div class="flex justify-center items-center sm:px-3 md:px-0"><img class="nearby-hero-image object-contain" src="' + location.c_heroImagePage.url + '" alt="' + location.c_heroImagePage.alternateText + '" width="200" height="200" style="width:100%;height:auto;"></div>' + 
                '<div class="grid address-cta-column px-5 py-5 gap-y-4"><a class="address text-xl font-semibold hover:underline" href="' +
                location.websiteUrl.url +
                '"><div>' +
                location.address.line1 +
                '</div><div class="address-line-2">' + 
                location.address.city + ', ' + location.address.region + ' ' + location.address.postalCode +
                '</div></a><div class="phoneNumber">' +
                location.mainPhone + 
                '</div><div class="availability"><strong>' +
                availability + 
                "</strong></div>" + 
                "<div class='mt-1 flex justify-center items-center'><a class='btn bg-ll-blue text-white flex hover:bg-ll-hover-blue w-3/5 sm:w-4/5 md:w-5/6 lg:w-4/5 xl:w-4/6' href='" +
                location.websiteUrl.url +
                "'>View Location</a></div>" +
                "</div></div>";
            } else {
            locationHTML =
                '<div class="col-md-3 col-sm-6 location"><div class="name">' +
                location.c_locationNickname +
                '</div><div class="address mt-2">' +
                location.address.line1 +
                '</div><div class="address-line-2">' + 
                location.address.city + ', ' + location.address.region + ' ' + location.address.postalCode +
                '</div><div class="availability mt-2"><strong>' +
                availability + 
                "</strong></div></div>";
            }
            //console.log(locationHTML);
            [].slice
            .call(document.querySelectorAll(".location-data") || [])
            .forEach(function (el) {
                el.innerHTML += locationHTML;
            });
        }
        }
    });
    });

</script>
